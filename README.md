# Telegram-бот для аналитики по видео на основе задач на естественном языке

## Контекст
Сервис хранит две таблицы:
- итоговую статистику по каждому видео (просмотры, лайки, комментарии и т.д.);
- почасовые «снапшоты» статистики по каждому видео (чтобы отслеживать динамику).

Необходимо сделать Telegram-бота, который умеет по запросу на естественном языке считать нужные метрики по этим данным.

**Stack:** aiogram, PostgreSQL, ollama::qwen2.5:7b, Docker

## Запуск

### Создание Telegram Bot Token


1. Откройте Telegram → найдите @BotFather (официальный бот с галочкой ✓)
2. Нажмите "Start" или отправьте команду
```
/start
```

3. Создайте бота: отправьте команду 
```
/newbot
```

4. Введите название бота (любое, отображается пользователям) и username бота
5. Полученный токен используйте в переменных окружения файла .env (BOT_TOKEN)

---

### Создание контейнеров 
Для запуска используются images: PostgreSQL, Ollama. Для локального развертывания модели требуется минимум 11 Гб оперативной памяти.

1. Запуск контейнеров
```
> docker-compose up -d
```

2. Загрузка модели:
```
> docker exec -it code-ollama ollama run qwen2.5:7b
```

---

### Преобразование запроса в SQL
Запрос передается на локально запущенную модель Ollama::qwen2.5:7b, которая формирует SQL-запрос по промпту, который расположен в app.ollama_handler.

---

### Пример файла с переменными окружения
```
LLM_URI=http://localhost:11434/api/generate
DB_URI=postgresql://postgres:secret@localhost:5432/demo
BOT_TOKEN=<токен телеграм-бота>
POSTGRES_USER=postgres
POSTGRES_PASSWORD=secret
POSTGRES_DB=demo
```